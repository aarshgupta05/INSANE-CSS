<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="profiles.css" rel="stylesheet">
    <title>Directory Listing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #222;
            color: white;
            padding: 20px;
        }
        .folder {
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
            padding: 8px;
            background-color: #444;
            border-radius: 5px;
            transition: 0.3s;
        }
        .folder:hover {
            background-color: #666;
        }
        .folder::before {
            content: "üìÅ ";
        }
        .file {
            margin-left: 20px;
            display: none;
            padding: 5px;
            border-radius: 3px;
            transition: 0.3s;
        }
        .file::before {
            content: "üìÑ ";
        }
        .file:hover {
            background-color: #555;
        }
    </style>
</head>
<body>
    <h1>üìÇ Project Directory</h1>
    <section id="directory-list">
        <!-- Folders & files will be loaded dynamically -->
    </section>

    <script>
        async function loadDirectory() {
            try {
                const response = await fetch(window.location.href);
                const text = await response.text();
    
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, "text/html");
    
                const links = Array.from(doc.querySelectorAll("a")); // Get all links
                const directoryList = document.getElementById("directory-list");
                directoryList.innerHTML = ""; // Clear previous content
    
                let folders = {};
    
                links.forEach((link) => {
                    let filePath = link.getAttribute("href");
                    let fileName = link.textContent.trim();
    
                    if (filePath === "../") return; // Ignore parent directory link
    
                    let isFolder = filePath.endsWith("/"); // Python server adds "/" for folders
                    let folderName = isFolder ? fileName : fileName.split("/")[0]; 
                    let file = isFolder ? null : fileName;
    
                    if (!folders[folderName]) {
                        folders[folderName] = [];
                    }
                    if (file) {
                        folders[folderName].push(file);
                    }
                });
    
                Object.entries(folders).forEach(([folderName, files]) => {
                    let folderDiv = document.createElement("div");
                    folderDiv.className = "folder";
                    folderDiv.textContent = folderName;
    
                    let fileContainer = document.createElement("div");
                    fileContainer.style.display = "none";
    
                    files.forEach(file => {
                        let fileDiv = document.createElement("div");
                        fileDiv.className = "file";
                        fileDiv.textContent = file;
                        fileContainer.appendChild(fileDiv);
                    });
    
                    folderDiv.addEventListener("click", () => {
                        fileContainer.style.display = fileContainer.style.display === "none" ? "block" : "none";
                    });
    
                    directoryList.appendChild(folderDiv);
                    directoryList.appendChild(fileContainer);
                });
    
            } catch (error) {
                console.error("Error loading directory:", error);
            }
        }
    
        loadDirectory();
    </script>    
</body>
</html>
